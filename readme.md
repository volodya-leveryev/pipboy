# Чат-бот «Помощник куратора»

## Таблица пользователей

Таблица пользователей позволяет чат-боту знать пользователей.

Таблица пользователей хранится в виде Google-таблицы (точно ???).

Администратор системы имеет доступ для редактирования таблицы пользователей.

В таблице пользователей имеются колонки:

* Телефон
* Telegram-логин
* Администратор - признак того что пользователь администратор системы
* ФИО
* Обращение - как чат-бот обращается к пользователю (Галина Михайловна, Петр)
* Группы - в каких группах и подгруппах состоит пользователь (строки 
  разделенные пробелом)
* Куратор - для каких групп данный пользователь может рассылать сообщения и 
  опросы (строки разделенные пробелом)
* Подключен ли пользователь к чат-боту
* Комментарий - примечание для администратора

## Таблица объявлений

Таблица объявлений позволяет чат-боту отправлять пользователям по их запросу заготовленные объявления. Например сведения о том как получить справку об учебе.

Таблица объявлений хранится в виде Google-таблицы (точно ???).

В таблице с объявлениями имеются колонки:

* Категория
* Заголовок
* Текст

## Как чат-бот с пользователями

Администратор может скомандовать чатботу перечитать таблицу пользователей или таблицу объявлений.

Чат-бот общается только с пользователями, которых знает по таблице пользователей.

Пользователи могут просматривать объявления из таблицы объявлений по категориям.

Пользователи могут искать объявления из таблицы объявлений по фрагменту текста.

Куратор может разослать пользователям по своим группам сообщения, файлы, фото, аудио.

Куратор видит прочитали ли пользователи сообщение или нет (по возможности в зависимости от настроек приватности пользователя).

Куратор может за запустить опрос пользователей с контролем ответа.

## Как чат-бот работает внутри

Таблицы пользователей и объявлений скачиваются из Google Sheets в формате CSV и хранятся в объектном хранилище (бакете). Хранение таблиц в Google Sheets позволяет обойтись без админки.

Чат-бот работает в режиме Webhook, на бессерверном сервисе Cloud Functions в облаке Яндекса. Это позволяет обойтись без хостинга и сократить расходы на инфраструктуру.

Чат-бот хранит данные о прочитанности сообщений пользователями в YDB.

Чат-бот хранит данные об ответах на опросы пользователей в YDB.

## Литература

* [Пример на Telegraf в Яндекс Сloud Functions](https://cloud.yandex.ru/docs/functions/tutorials/telegram-bot-serverless)
* [API Telegram](https://core.telegram.org/)
* [JavaScript (Telegraf)](https://telegrafjs.org/)
* [Python Telegram Bot](https://docs.python-telegram-bot.org/en/v20.0a4/)
* [pyTelegramBotAPI (Telebot)](https://pytba.readthedocs.io/en/latest/index.html)
